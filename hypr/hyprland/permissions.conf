###################
### PERMISSIONS ###
###################
# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃ QUYỀN TRUY CẬP (PERMISSIONS) - Cấu hình quyền cho các ứng dụng và plugin trong Hyprland (security & compatibility) ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
# Tài liệu chính thức: https://wiki.hypr.land/Configuring/Permissions/
# Phần này định nghĩa quyền truy cập (permissions) cho các ứng dụng và plugin, giúp kiểm soát những gì được phép làm (như screencopy, plugin loading).
# Hyprland có hệ thống permission mặc định strict để bảo mật, đặc biệt với Wayland (sandboxing tốt hơn X11).
# Lưu ý quan trọng:
# - **Thay đổi permissions cần RESTART Hyprland** (không chỉ reload config) để áp dụng; dùng 'hyprctl exit' rồi login lại.
# - Chỉ thêm rule khi gặp lỗi cụ thể (ví dụ: "permission denied" khi chụp màn hình hoặc load plugin).
# - Permission cú pháp: permission = <path_to_binary>, <permission_type>, <allow/deny>
#   - <path_to_binary>: Đường dẫn chính xác đến file thực thi (dùng 'which <app>' để tra; hỗ trợ regex như /usr/(bin|local/bin)/app).
#   - <permission_type>: screencopy (cho screenshot/stream), plugin (cho hyprpm/plugin), v.v.
#   - <allow/deny>: allow để cấp quyền, deny để chặn.
# - Mặc định, Hyprland deny all trừ khi explicit allow; chỉ allow app đáng tin cậy để tránh rủi ro bảo mật.
# - Debug: Nếu lỗi permission, check log '~/.hypr/hyprland.log' hoặc 'journalctl -u seatd' (nếu dùng seatd).

# ===== 1. BẬT ECOSYSTEM PERMISSIONS (hiếm khi dùng, chỉ cho expert/multi-user) =====
# Block ecosystem: Bật enforce_permissions để khóa chặt quyền toàn hệ thống (plugin, portal, v.v.).
# - enforce_permissions = 1: Buộc áp dụng permission rules nghiêm ngặt (mặc định 0 - loose).
# - Chỉ bật trong môi trường multi-user (server, shared PC) hoặc khi cần lockdown; có thể gây lỗi app nếu không config đầy đủ.
# ecosystem {
#     enforce_permissions = 1 # Bật enforce mode (1: strict permission check; 0: default loose - khuyến nghị cho user cá nhân)
# }
# → Chỉ uncomment khi cần lockdown plugin/hệ thống cho môi trường chia sẻ; test kỹ vì có thể break compatibility.

# ===== 2. SCREENCOPY (CHO PHÉP CHỤP VÀ STREAM MÀN HÌNH) =====
# Permission type 'screencopy': Cấp quyền cho app chụp/share màn hình (screenshot, recording, streaming).
# - Cần thiết cho: grim (screenshot), wf-recorder (video record), xdg-desktop-portal-hyprland (Flatpak sandbox, Zoom/Discord share screen), livestream tools.
# - Nếu không allow, app sẽ lỗi "permission denied" hoặc không capture được (đặc biệt Wayland secure by design).
# - Gợi ý: Chỉ allow app bạn dùng; dùng regex cho path linh hoạt (/usr/(bin|local/bin)/app).
# - Cho Flatpak/portal: Phải allow xdg-desktop-portal-hyprland vì nó proxy request từ app sandboxed.
# --- Cho phép các tool screenshot/recording cơ bản (grim, wf-recorder) ---
# permission = /usr/(bin|local/bin)/grim, screencopy, allow # Allow grim (screenshot tool; regex cho bin/local/bin)
# permission = /usr/(bin|local/bin)/wf-recorder, screencopy, allow # Allow wf-recorder (screen recording; Wayland-native)
# --- Cho phép xdg-desktop-portal-hyprland (dùng cho Flatpak, Zoom, Discord, OBS share screen, v.v.) ---
# permission = /usr/(lib|libexec|lib64)/xdg-desktop-portal-hyprland, screencopy, allow # Allow portal (proxy cho app sandbox; regex cho lib variants)
# --- Nếu cài tool ở path riêng (vd: ~/bin/grim hoặc custom build) ---
# permission = /home/<user>/bin/grim, screencopy, allow # Allow grim ở user bin (thay <user> bằng username thật; ví dụ: /home/grok/bin/grim)

# ===== 3. PLUGIN (CHO PHÉP plugin, hyprpm...) =====
# Permission type 'plugin': Cấp quyền load/run plugin (hyprpm - Hyprland plugin manager).
# - Cần thiết nếu dùng hyprpm hoặc custom plugin; mặc định deny để tránh malicious code.
# - Chỉ allow nếu bạn install plugin từ nguồn tin cậy (official repo).
# permission = /usr/(bin|local/bin)/hyprpm, plugin, allow # Allow hyprpm (plugin manager; regex cho bin/local/bin)

# ===== 4. TIPS & HƯỚNG DẪN THÊM (Additional Rules & Customization) =====
# ▸ Chỉ uncomment/add rule khi gặp lỗi cụ thể: Ví dụ, nếu OBS Studio không share screen, tra path bằng 'which obs' rồi add permission = <path>, screencopy, allow.
# ▸ Tra path chính xác: Chạy 'which <app>' (cho bin) hoặc 'locate <app>' (toàn hệ thống); cho Flatpak, path thường /var/lib/flatpak/app/<id>/... nhưng portal handle.
# ▸ Flatpak-specific: Đa phần cần allow portal (xdg-desktop-portal-hyprland); cài flatpak-portal nếu lỗi (flatpak install org.freedesktop.Portal.Hyprland).
# ▸ Livestream/advanced tools: Copy template từ grim/wf-recorder và sửa tên/path (ví dụ: permission = /usr/bin/obs, screencopy, allow cho OBS).
# ▸ Deny example: Nếu muốn chặn app cụ thể, dùng deny (permission = <path>, screencopy, deny) - hiếm dùng trừ security audit.

# ===== 5. TÓM TẮT NHANH & PRO TIPS =====
# - Chỉ thêm rule cho app thật sự cần thiết: Quá nhiều allow giảm bảo mật; ưu tiên minimalism.
# - Chỉnh xong phải restart Hyprland: Reload config (hyprctl reload) không đủ cho permissions.
# ▸ Pro Tips - Siêu Secure & Optimize:
#   - Multi-user: Bật ecosystem.enforce_permissions=1 và add per-user rules nếu cần isolation.
#   - Custom regex: Dùng wildcards như /usr/bin/*-recorder cho all recording tools, nhưng cẩn thận tránh broad allow.
#   - Audit permissions: Chạy 'hyprctl getoption permissions' để check current rules; log errors để debug.
#   - Alternatives: Nếu không muốn permission, dùng XWayland cho app cũ (nhưng kém secure); hoặc switch to portals cho sandbox.
#   - Nhớ: Permissions là layer bảo mật - config đúng để cân bằng usability và safety, giữ hệ thống "feel glass" (mượt mà, không lỗi)!